# This = country scope
suelg_init_country_vars = {
	if = { 
		limit = {
			NOT = {
				is_variable_set = suelg_max_scan_level
			}
		}
		set_variable = { which = suelg_max_scan_level value = 0 }
	}
}

# This = Planet scope
suelg_init_planet_vars = {
	if = { # init planet vars
		limit = {
			NOT = { is_variable_set = suelg_started_scan_lvl }
		}
		set_variable = { which = suelg_started_scan_lvl value = 0 }
		set_variable = { which = suelg_completed_scan_lvl value = 0 }
	}
}

# This = System scope
suelg_create_system_scan_projects = {
	owner = {
		save_event_target_as = t_owner
	}

	every_system_planet = {
		suelg_init_planet_vars = yes

		if = {
			limit = {								
				suelg_can_be_scanned = yes
				check_variable = { which = suelg_completed_scan_lvl value < event_target:t_owner.suelg_max_scan_level }
				check_variable = { which = suelg_completed_scan_lvl value = suelg_started_scan_lvl }
			}

			change_variable = { which = suelg_started_scan_lvl value = 1 }
			# log = ">> CREATE PROJECT. PLANET: [This.GetName] LVL: [This.suelg_started_scan_lvl]"

			inline_script = { script = suelg_create_project LVL = 1 }
			inline_script = { script = suelg_create_project LVL = 2 }
			inline_script = { script = suelg_create_project LVL = 3 }
			inline_script = { script = suelg_create_project LVL = 4 }
			inline_script = { script = suelg_create_project LVL = 5 }
			inline_script = { script = suelg_create_project LVL = 6 }
			inline_script = { script = suelg_create_project LVL = 7 }
			inline_script = { script = suelg_create_project LVL = 8 }
			inline_script = { script = suelg_create_project LVL = 9 }
			inline_script = { script = suelg_create_project LVL = 10 }
			inline_script = { script = suelg_create_project LVL = 11 }
			inline_script = { script = suelg_create_project LVL = 12 }
			inline_script = { script = suelg_create_project LVL = 13 }
			inline_script = { script = suelg_create_project LVL = 14 }
			inline_script = { script = suelg_create_project LVL = 15 }
			prev = {
				set_star_flag = suelg_has_scan_projects
			}
		}
	}
}

# this = system scope
suelg_reset_system_projects = {
	remove_star_flag = suelg_has_scan_projects
	every_system_planet = {
		suelg_init_planet_vars = yes
		if = {
			limit = {								
				suelg_can_be_scanned = yes
				check_variable = { which = suelg_started_scan_lvl value > suelg_completed_scan_lvl }
			}

			save_event_target_as = reset_planet_t

			if = {
				limit = {
					NOT = { has_planet_flag = suelg_has_researcher }
				}
				set_variable = { which = suelg_started_scan_lvl value = suelg_completed_scan_lvl }

				# log = ">> REMOVE PROJECT. PLANET: [this.GetName]"
				event_target:t_owner = {
					abort_special_project = { type = suelg_deep_scan_SP_1 location = event_target:reset_planet_t }
				}
				
				remove_planet_flag = suelg_has_researcher
				remove_planet_flag = suelg_hasnt_completed_project
			}
		}
	}
}

# this = planes scope
suelg_update_complete_scan_mod = {
	remove_modifier = suelg_deep_scanned_1
	remove_modifier = suelg_deep_scanned_2
	remove_modifier = suelg_deep_scanned_3
	remove_modifier = suelg_deep_scanned_4
	remove_modifier = suelg_deep_scanned_5
	remove_modifier = suelg_deep_scanned_6
	remove_modifier = suelg_deep_scanned_7
	remove_modifier = suelg_deep_scanned_8
	remove_modifier = suelg_deep_scanned_9
	remove_modifier = suelg_deep_scanned_10
	remove_modifier = suelg_deep_scanned_11
	remove_modifier = suelg_deep_scanned_12
	remove_modifier = suelg_deep_scanned_13
	remove_modifier = suelg_deep_scanned_14
	remove_modifier = suelg_deep_scanned_15

	save_event_target_as = t_mod_star
	solar_system = {
		inline_script = { script = add_complete_scan_mod LVL = 1 }
		inline_script = { script = add_complete_scan_mod LVL = 2 }
		inline_script = { script = add_complete_scan_mod LVL = 3 }
		inline_script = { script = add_complete_scan_mod LVL = 4 }
		inline_script = { script = add_complete_scan_mod LVL = 5 }
		inline_script = { script = add_complete_scan_mod LVL = 6 }
		inline_script = { script = add_complete_scan_mod LVL = 7 }
		inline_script = { script = add_complete_scan_mod LVL = 8 }
		inline_script = { script = add_complete_scan_mod LVL = 9 }
		inline_script = { script = add_complete_scan_mod LVL = 10 }
		inline_script = { script = add_complete_scan_mod LVL = 11 }
		inline_script = { script = add_complete_scan_mod LVL = 12 }
		inline_script = { script = add_complete_scan_mod LVL = 13 }
		inline_script = { script = add_complete_scan_mod LVL = 14 }
		inline_script = { script = add_complete_scan_mod LVL = 15 }
	}
}

# this = ship scope
suelg_get_sp_base_days = {
	set_variable = { which = suelg_survey_speed_mod value = 1000 } # fallback

	inline_script = { script = suelg_get_sp_base_days LVL = 1 }
	inline_script = { script = suelg_get_sp_base_days LVL = 2 }
	inline_script = { script = suelg_get_sp_base_days LVL = 3 }
	inline_script = { script = suelg_get_sp_base_days LVL = 4 }
	inline_script = { script = suelg_get_sp_base_days LVL = 5 }
	inline_script = { script = suelg_get_sp_base_days LVL = 6 }
	inline_script = { script = suelg_get_sp_base_days LVL = 7 }
	inline_script = { script = suelg_get_sp_base_days LVL = 8 }
	inline_script = { script = suelg_get_sp_base_days LVL = 9 }
	inline_script = { script = suelg_get_sp_base_days LVL = 10 }
	inline_script = { script = suelg_get_sp_base_days LVL = 11 }
	inline_script = { script = suelg_get_sp_base_days LVL = 12 }
	inline_script = { script = suelg_get_sp_base_days LVL = 13 }
	inline_script = { script = suelg_get_sp_base_days LVL = 14 }
	inline_script = { script = suelg_get_sp_base_days LVL = 14 }
}

# this = ship scope
suelg_add_survey_s_by_l_traits = {
	inline_script = { script = suelg_add_survey_speed_f T = subclass_scientist_explorer F = 0.85 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_roamer F = 0.85 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_roamer_2 F = 0.65 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_custom_AI_assistant F = 0.9 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_sapient_AI_assistant F = 0.8 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_midas_touch F = 0.75 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_xeno_cataloger F = 0.65 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_curator F = 0.75 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_towel F = 0.58 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_scholarium_explorer F = 0.8 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_brainslug F = 0.9 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_psionic F = 0.75 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_chosen F = 0.5 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_composer_chosen F = 0.75 }
	inline_script = { script = suelg_add_survey_speed_f T = gestalt_trait_scientist_mind_wipe_01 F = 1.2 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_neurotic F = 1.1 }
	inline_script = { script = suelg_add_survey_speed_f T = leader_trait_neurotic_2 F = 1.3 }
}

suelg_add_survey_s_by_l_lvl = {
	# per leader level. Each level +1%
	leader = {
		set_variable = { which = suelg_leader_lvl_bonus value = trigger:has_skill }
		multiply_variable = { which = suelg_leader_lvl_bonus value = -0.01 }
		change_variable = { which = suelg_leader_lvl_bonus value = 1 }
	}
	multiply_variable = { which = suelg_survey_speed_mod value = leader.suelg_leader_lvl_bonus }
	leader = {
		clear_variable = suelg_leader_lvl_bonus
	}
}

suelg_add_survey_s_by_owner = {
	# owner modifiers
	if = {
		limit = { owner = { has_agenda_selected = agenda_chart_the_unknown } }
		multiply_variable = { which = suelg_survey_speed_mod value = 0.75 }
	}
	if = {
		limit = { owner = { has_modifier = agenda_chart_the_unknown_finish } }
		multiply_variable = { which = suelg_survey_speed_mod value = 0.75 }
	}
	if = {
		limit = { owner = { has_modifier = paragon_death_to_the_stars } }
		multiply_variable = { which = suelg_survey_speed_mod value = 0.8 }
	}
	if = {
		limit = { owner = { has_modifier = science_inspiration } }
		multiply_variable = { which = suelg_survey_speed_mod value = 0.2 }
	}
	if = {
		limit = { owner = { has_edict = map_the_stars } }
		multiply_variable = { which = suelg_survey_speed_mod value = 0.75 }
	}
	if = {
		limit = { owner = { has_civic = civic_eager_explorers } }
		multiply_variable = { which = suelg_survey_speed_mod value = 0.8 }
	}
	if = {
		limit = { owner = { has_policy_flag = toxic_knights_questing } }
		multiply_variable = { which = suelg_survey_speed_mod value = 0.85 }
	}
	if = {
		limit = { owner = { has_active_tradition = tr_discovery_to_boldly_go } }
		multiply_variable = { which = suelg_survey_speed_mod value = 0.65 }
	}
	if = {
		limit = { owner = { has_technology = tech_automated_exploration } }
		multiply_variable = { which = suelg_survey_speed_mod value = 0.75 }
	}
	if = {
		limit = { owner = { has_technology = tech_curator_lab } }
		multiply_variable = { which = suelg_survey_speed_mod value = 0.67 }
	}
	# todo: add situation "paragon_origin_promise" modifier
}